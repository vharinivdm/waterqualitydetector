<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaGuard AI - Premium Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* --- 1. COOL BACKGROUND & TYPOGRAPHY --- */
        body {
            /* High-quality water background image */
            background: linear-gradient(rgba(0, 20, 40, 0.7), rgba(0, 20, 40, 0.7)), url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: 'Poppins', sans-serif;
            color: #fff; /* White text for dark background */
            min-height: 100vh;
        }

        /* Transparent Hero Section */
        .hero {
            background: transparent;
            padding: 60px 20px 30px;
            text-align: center;
            text-shadow: 0 4px 8px rgba(0,0,0,0.6);
        }
        .hero h1 { font-weight: 600; font-size: 3.5rem; letter-spacing: 1px; }
        .hero p { font-size: 1.2rem; opacity: 0.9; }

        /* --- 2. GLASSMORPHISM CARDS --- */
        .main-card {
            background: rgba(255, 255, 255, 0.1); /* Semi-transparent white */
            backdrop-filter: blur(15px); /* Blurry glass effect */
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            padding: 35px;
            margin-bottom: 30px;
            transition: transform 0.3s ease;
        }
        .main-card:hover { transform: translateY(-5px); }

        /* Headings and Text inside Glass Cards */
        .card-title-custom { font-weight: 600; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .text-muted-light { color: rgba(255, 255, 255, 0.7) !important; }

        /* Form Elements */
        .form-control {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #fff;
            padding: 12px;
            border-radius: 10px;
        }
        /* Fix for file input text color */
        .form-control::file-selector-button { background: rgba(255,255,255,0.3); color: #fff; border: none; }
        .form-control:focus { background: rgba(255, 255, 255, 0.3); color: #fff; box-shadow: none; }

        /* Buttons */
        .btn-custom {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            transition: all 0.3s;
        }
        .btn-blue { background: linear-gradient(135deg, #00c6ff, #0072ff); color: white; }
        .btn-blue:hover { box-shadow: 0 0 15px #00c6ff; }
        .btn-cyan { background: linear-gradient(135deg, #00d2ff, #3a7bd5); color: white; }
        .btn-cyan:hover { box-shadow: 0 0 15px #00d2ff; }

        /* --- 3. RESULT SECTIONS --- */
        .result-section {
            display: none; /* Hidden by default */
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Inner Result Cards */
        .result-card-inner {
            background: rgba(0, 0, 0, 0.25); /* Darker semi-transparent for contrast */
            border-radius: 15px;
            padding: 25px;
            height: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .result-value { font-size: 2.5rem; font-weight: 700; margin: 10px 0; }

        /* Alert & Insight Boxes */
        .alert-box-custom {
            border-radius: 15px;
            padding: 25px;
            color: white;
            height: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .bg-danger-grad { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
        .bg-success-grad { background: linear-gradient(135deg, #00b09b, #96c93d); }
    </style>
</head>
<body>

    <div class="hero">
        <h1>üíß AquaGuard AI</h1>
        <p>Advanced Water Quality & Smart Meter Analytics</p>
    </div>

    <div class="container" style="max-width: 900px;">
        
        <div class="main-card">
            <h3 class="card-title-custom">üõ°Ô∏è Water Quality Detection</h3>
            <p class="text-muted-light">Upload a sample image to analyze transparency and potential contaminants.</p>
            
            <div class="mb-4">
                <input type="file" id="fileQuality" class="form-control" accept="image/*">
            </div>
            <button class="btn btn-custom btn-blue" onclick="checkQuality()">‚ú® Analyze Sample</button>

            <div id="qualityResultSection" class="result-section">
                <h4 class="text-center mb-4" style="font-weight: 600;">üìä Analysis Results</h4>
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="result-card-inner">
                            <h5>üõ°Ô∏è Safety Status</h5>
                            <div id="safetyStatus" class="result-value">--</div>
                            <p id="safetyScore" class="text-muted-light mb-0">Score: --</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div id="alertCard" class="alert-box-custom bg-success-grad">
                            <h5>üîî Realtime Alert</h5>
                            <h3 id="alertMsg" class="mt-3" style="font-weight: 600;">System Normal</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="main-card">
            <h3 class="card-title-custom">üî¢ Smart Meter Reader</h3>
            <p class="text-muted-light">Take a photo of your analog water meter for instant digitization.</p>
            
            <div class="mb-4">
                <input type="file" id="fileMeter" class="form-control" accept="image/*">
            </div>
            <button class="btn btn-custom btn-cyan" onclick="checkMeter()">üì∏ Scan Meter</button>

            <div id="meterResultSection" class="result-section">
                <h4 class="text-center mb-4" style="font-weight: 600;">üìä Meter & Usage Insights</h4>
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="result-card-inner">
                            <h5>üíß Water Usage</h5>
                            <div id="usageVal" class="result-value">0 Liters</div>
                            <p id="monthlyEst" class="text-muted-light mb-0">Month: --</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert-box-custom bg-success-grad">
                            <h5>üå± Conservation Insights</h5>
                            <p id="insightMsg" class="mt-3" style="font-size: 1.1rem;">Scan to get personalized insights.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        async function checkQuality() {
            let fileInput = document.getElementById('fileQuality');
            if (fileInput.files.length === 0) return alert("Please select an image file first!");
            
            let formData = new FormData();
            formData.append("file", fileInput.files[0]);

            // 1. Show Quality Results, Hide Meter Results
            document.getElementById('qualityResultSection').style.display = 'block';
            document.getElementById('meterResultSection').style.display = 'none';

            // 2. Loading state
            document.getElementById('safetyStatus').innerText = "Analyzing...";

            let response = await fetch('/predict_quality', { method: "POST", body: formData });
            let data = await response.json();

            // 3. Fill Dashboard Data
            document.getElementById('safetyStatus').innerText = data.safety_status.replace('‚ùå','').replace('‚úÖ','');
            document.getElementById('safetyScore').innerText = "Score: " + data.safety_score;
            document.getElementById('alertMsg').innerText = data.alert.replace('‚ö†Ô∏è ALERT: ','').replace('‚úÖ ','');

            // 4. Change Alert Color based on result
            let alertCard = document.getElementById('alertCard');
            if(data.safety_status.includes("UNSAFE")) {
                alertCard.className = "alert-box-custom bg-danger-grad"; // Red gradient
            } else {
                alertCard.className = "alert-box-custom bg-success-grad"; // Green gradient
            }
        }

        async function checkMeter() {
            let fileInput = document.getElementById('fileMeter');
            if (fileInput.files.length === 0) return alert("Please select an image file first!");

            let formData = new FormData();
            formData.append("file", fileInput.files[0]);

            // 1. Show Meter Results
            document.getElementById('meterResultSection').style.display = 'block';
            document.getElementById('qualityResultSection').style.display = 'none';

            // 2. Loading...
            document.getElementById('usageVal').innerText = "Scanning...";

            let response = await fetch('/read_meter', { method: "POST", body: formData });
            let data = await response.json();

            // 3. Fill Dashboard Data
            document.getElementById('usageVal').innerText = data.usage;
            
            // FIX: Removed "Est: " string because python now sends the full text "Eco Limit: ..."
            document.getElementById('monthlyEst').innerText = data.monthly_est;
            
            document.getElementById('insightMsg').innerText = data.conservation;

            // 4. COLOR LOGIC (Red for High Usage, Green for Low)
            let insightBox = document.querySelector('#meterResultSection .alert-box-custom');
            
            if (data.is_high === true) {
                // Change to RED Gradient
                insightBox.className = "alert-box-custom bg-danger-grad"; 
            } else {
                // Change to GREEN Gradient
                insightBox.className = "alert-box-custom bg-success-grad"; 
            }
        }
    </script>
</body>
</html>